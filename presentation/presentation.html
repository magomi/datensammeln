<html>
    <head>
        <title>Datensammeln ohne Reue</title>
        <link rel="stylesheet" href="reveal.js/css/reveal.css">
        <link rel="stylesheet" href="reveal.js/css/theme/white.css">
        <link rel="stylesheet" href="reveal.js/lib/css/zenburn.css">
   </head>
    <body>
        <div class="reveal">
            <div class="slides">

<!-- ------ Titel ------- -->
<section>
    <h1>Modernes Logging</h1>
    <h2>Datensammeln ohne Reue</h2>
    <p>&nbsp;</p>
    <p>&nbsp;</p>
    <p>Bert Radke</p>
    <p>Marco Grunert</p>
    <p>T-Systems Multimedia Solutions GmbH</p>
</section>

<!-- ------ Einstieg  ------ -->
<section>
   <pre><code data-trim data-noescape>System.out.println("Customer " + 637208 + " not found");</code></pre>
</section>
<section>
    <h1>Vielen Dank f&uuml;r eure Aufmerksamkeit!</h1>
    <h1>&nbsp;</h1>
    <h2>Fragen? Anmerkungen?</h2>
</section>
<section>
    <pre><code class="java" data-trim data-noescape>System.out.println("Customer " + 637208 + " not found");</code></pre>
    <h3>&nbsp;</h3>
    <h3>Reicht das wirklich?</h3>
    <aside class="notes">
        <ul>
            <li>Wo ist das aufgetreten?</li>
            <li>Wann ist das aufgetreten?</li>
            <li>Ist das ein Fehler? Ein Hinweis? Oder nur Debug?</li>
            <li>Steurung/Konfiguration ohne SW-&Auml;nderung</li>
        </ul>
    </aside>
</section>
<section>
    <h1>Warum sammeln wir Daten?</h1>
    <p>&nbsp</p>
    <ul>
       <li class="fragment">Zustand von Anwendungen &uuml;berwachen</li>
       <li class="fragment">Abl&auml;ufe nachvollziehen</li>
       <li class="fragment">Entwickler unterst&uuml;tzen</li>
       <li class="fragment">Performance messen</li>
     </ul>
     <aside class="notes">
        <ul>
            <li>Zustand von Anwendungen &uuml;berwachen</li>
            <li>Abl&auml;ufe nachvollziehen</li>
            <li>Entwickler unterst&uuml;tzen</li>
            <li>Performance messen</li>
        </ul>
    </aside>
</section>
<section>
    <h1>F&uuml;r wen sammeln wir Daten?</h1>
    <p>&nbsp</p>
    <ul>
        <li class="fragment">Entwickler</li>
        <li class="fragment">Betrieb</li>
        <li class="fragment">Anwender</li>
    </ul>
    <aside class="notes">
        <ul>
            <li>Entwickler</li>
            <li>Betrieb</li>
            <li>Anwender?</li>
        </ul>
    </aside>
</section>
<section>
    <h1>Was wollen wir eigentlich?</h1>
    <p>&nbsp;</p>
    <ul>
        <li class="fragment">Trennung von Content und Pr&auml;sentation</li>
        <li class="fragment">Steuerung der Konfiguration</li>
        <ul>
            <li class="fragment">Was wird geloggt?</li>
            <li class="fragment">Wohin wird geloggt?</li>
            <li class="fragment">Wie wird Ausgabe formatiert?</li>
        <ul>
    </ul>
</section>

<!-- ------ aktueller Stand  ------ -->
<section>
    <h1>Was verwenden wir heutzutage</h1>
    <p>&nbsp;</p>
    <ul>
        <li class="fragment">JUL (java.util.logging)</li>
        <li class="fragment">Apache Java Commons Logging</li>
        <li class="fragment">Log4J (Version 1 und 2)</li>
        <li class="fragment">LOGBack</li>
    </ul>
</section>
<section>
    <section>
        <h1>Grundlegende Konzepte</h1>
        <p>&nbsp;</p>
        <ul>
            <li class="fragment">Log Level</li>
            <li class="fragment">Logger</li>
            <li class="fragment">Appender</li>
            <li class="fragment">Layout</li>
            <li class="fragment">Encoder</li>
        </ul>
    </section>
    <section>
        <h2>Log Level</h2>
        <p>&nbsp;</p>
        <ul>
            <li class="fragment">ERROR</li>
            <li class="fragment">WARNING</li>
            <li class="fragment">INFO</li>
            <li class="fragment">DEBUG</li>
            <li class="fragment">TRACE</li>
        </ul>
    </section>
    <section>
        <h2>Logger</h2>
        <p>&nbsp;</p>
        <ul>
            <li class="fragment">Hierarchie</li>
            <pre class="fragment"><code data-trim data-noescape>
"org.apache.commons.io.FileUtils"
"org.apache.commons.io"
"org.apache.commons"
            </code></pre>
            <li class="fragment">immer genau einem Log level zugewiesen</li>
            <li class="fragment">mindestens einem Appender zugewiesen</li>
        </ul>
        <aside class="notes">
          <ul>
            <li>root logger immer automatisch vom Framework gesetzt</li>
          </ul>
        </aside>
    </section>
    <section>
        <h2>Appender, Ausgabeziel</h2>
        <p>&nbsp;</p>
        <ul>
            <li class="fragment">File</li>
            <li class="fragment">Database</li>
            <li class="fragment">Socket</li>
            <li class="fragment">Console</li>
            <li class="fragment">JMS</li>
            <li class="fragment">Syslog</li>
            <li class="fragment">Mail</li>
            <li class="fragment">SNMP</li>
            <li class="fragment">...</li>
        </ul>
        <aside class="notes">
          <p>RollingFileAppender,...</p>
        </aside>
    </section>
    <section>
        <h2>Layout</h2>
        <p>&nbsp;</p>
        <ul>
          <li class="fragment">PatternLayout</li>
          <li class="fragment">JsonLayout</li>
          <li class="fragment">HtmlLayout</li>
          <li class="fragment">XmlLayout</li>
          <li class="fragment">CSV, SyslogLayout, ...</li>
        </ul>
        <aside class="notes">
          <p>Am Beispiel Log4j 2</p>
          <p>Beschreiben das Format / Layout eines Logevents</p>
        </aside>
    </section>
    <section>
        <h2>Encoder</h2>
        <p>&nbsp;</p>
        <ul>
          <li class="fragment">Flexibler als Layouts</li>
          <li class="fragment">k&ouml;nnen an Layouts delegieren / wrappen</li>
        </ul>
        <aside class="notes">
          <p>nur LOGBack</p>
          <p>wurden mit 0.9.19 eingef&uuml;hrt, da Layouts nur Strings schreiben k&ouml;nnen</p>
        </aside>
    </section>
</section>
<section>
    <pre><code class="hljava" data-trim data-noescape>
package com.tsmms.jug;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

/**
 * @author Grunert, Marco <marco@grnrt.org>
 */
public class LogDemo {
    static final Logger logger = LoggerFactory.getLogger(LogDemo.class);

    public static void main(String[] args) {
        logger.info("application [] started")
        Alice alice = new Alice(23, "Naive Project Manager");
        Bob bob = new Bob(42, "Grumpy IT Guy");
    }
}
    </code></pre>
</section>
<section>
    <section>
        <h1>Advanced Features</h1>
        <p>&nbsp;</p>
        <ul>
            <li class="fragment">Asynchrone Logger</li>
            <li class="fragment">Mapped Diagnostic Context</li>
        </ul>
    </section>
    <section>
        <h2>Asynchrone Logger / Appender</h2>
        <p>&nbsp;</p>
        <ul>
            <li class="fragment">Entkopplung Sender und Empf&auml;nger</li>
            <li class="fragment">Log4j 1 und LOGBack: DQueue</li>
            <li class="fragment">Log4j 2 LMAX Disruptors</li>
        </ul>
        <aside class="notes">
          <p>Problem in stark Multi-Threaded Apps: Threads blocken alle am Appender</p>
          <p>LOGBack verwirft &lt; WARN wenn Queue zu 80% voll</p>
          <p>Studie: DQueues ineffizient</p>
          <p>N&auml;chste Seite: Bild</p>
        </aside>
    </section>
    <section>
      <img style="border:0;" data-src="images/async-vs-sync-throughput.png" alt="Log4j 2 throughput">
    </section>
    <section>
      <img style="border:0;" data-src="images/async-throughput-comparison.png" alt="Log4j 2 throughput">
    </section>
    <section>
        <h2>Mapped Diagnostic Context</h2>
        <p>&nbsp;</p>
        <p>...</p>
    </section>
</section>
<section>
    <section>
        <h2>Welches Framework?</h2>
        <p>&nbsp;</p>
        <ul>
            <li class="fragment">JUL und JCL nicht mehr aktuell und keine Weiterentwicklung.</li>
            <li class="fragment">Vorteil JUL: keine zus&auml;tzliche Abh&auml;ngigkeiten.</li>
            <li class="fragment">Entscheidung zwischen SLF4J/Log4j 2 und SLF4J/LOGback.</li>
        </ul>
        <aside class="notes">
            <ul>
                <li>SLF4J: config beispiel</li>
            </ul>
        </aside>
    </section>
    <section>
        <h2>Lessons Learned/Best Practice</h2>
        <p>&nbsp;</p>
        <ul>
            <li class="fragment">Verwendung der SLF4J API im eigenen Code.</li>
            <li class="fragment">Loggingframework wird zur Laufzeit durch Classpath bestimmt.</li>
            <li class="fragment">Fremdbibliotheken haben h&auml;ufig feste Abh&auml;ngigkeit zu bestimmmten Framework.</li>
            <li class="fragment">Auswahl per Build-Tool.</li>
            <li class="fragment">Ersetzen von JUL oder JCL durch SLF4J - Stubbs.</li>
        </ul>
        <aside class="notes">
                <p>Beispiel Maven next</p>
        </aside>
    </section>
    <section>
        <pre><code class="hlxml" data-trim >
          <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-core</artifactId>
            <version>${spring.version}</version>
            <exclusions>
              <exclusion>
                <groupId>commons-logging</groupId>
                <artifactId>commons-logging</artifactId>
              </exclusion>
            </exclusions>
          </dependency>
          <dependency>
            <groupId>org.slf4j</groupId>
            <artifactId>jcl-over-slf4j</artifactId>
          </dependency>
        </code></pre>
    </section>
</section>

<!-- ------ Was bereitet uns Kopfschmerzen?  ------ -->
<section>
    <section>
        <h1>Reicht das?</h1>
        <p>&nbsp;</p>
        <ul>
            <li class="fragment">Wie werden die Daten weiterverarbeitet?</li>
            <li class="fragment">Wie gehen wir mit mehreren Datenquellen um?</li>
            <li class="fragment">Wie finden wir notwendige Informationen?</li>
            <li class="fragment">Haben wir die richtigen Informationen erfasst?</li>
        </ul>
    </section>
</section>
<section>
    <section>
        <h2>Wie werden Daten weiterverarbeitet?</h2>
        <p>&nbsp;</p>
        <aside class="notes">
            <ul>
                <li>zentrale Erfassung in größeren Systemen</li>
                <li>Analyse der Daten durch unterschiedliche Personenkreise</li>
                <li>Einbindung in zentrale Nutzerberechtigung</li>
                <li>...</li>
            </ul>
        </aside>
    </section>
    <section>
        <h2>Wie gehen wir mit mehreren Datenquellen um?</h2>
        <p>&nbsp;</p>
        <aside class="notes">
            <ul>
                <li>Systeme sind üblicherweise verteilt</li>
                <li>eindeutige Identifier notwendig</li>
                <li>zentrale Zeitquelle</li>
                <li>...</li>
            </ul>
        </aside>
    </section>
    <section>
        <h2>Wie finden wir notwendige Informationen?</h2>
        <p>&nbsp;</p>
        <aside class="notes">
            <ul>
                <li>Suche in Datenbeständen notwendig.</li>
                <li>Identfier müssen über mehrere Datenquellen transportiert werden</li>
                <li>Arbeit in Textdateien mit regulären Ausdrücken</li>
                <li>Suche ist nicht performant</li>
                <li>...</li>
            </ul>
        </aside>
    </section>
    <section>
        <h2>Haben wir die richtigen Informationen erfasst?</h2>
        <p>&nbsp;</p>
        <aside class="notes">
            <ul>
                <li>Suche abhängig von Fragestellung</li>
                <li>Fehler nicht vorher bekannt</li>
                <li>Nutzerverhalten nicht vorher bekannt</li>
                <li>Auswirkungen auf Änderungen müssen nachvollzogen werden</li>
            </ul>
        </aside>
    </section>
</section>

<!-- ------ Logging weitergedacht  ------ -->
<section>
    <h1>Logging weiter gedacht</h1>
    <p>&nbsp;</p>
    <ul>
        <li class="fragment">Zentrale Ablage</li>
        <li class="fragment">Strukturierung der Daten</li>
        <li class="fragment">Aggregation von Daten</li>
        <li class="fragment">Performanter Zugriff</li>
    </ul>
    <aside>
        <ul>
            <li>Zentrale Ablage: <b></b></li>
            <li>Strukturierung: kategorisieren, vorfiltern, sortieren</li>
            <li>Aggregation: Zeitstempel, Quellen zusammenfassen</li>
            <li>Performance: Verteilung, Indexierung</li>
        </ul>
    </aside>
</section>
<section>
    <h1>Zentrale Logging-Server</h1>
    <p>&nbsp;</p>
    <ul>
        <li>passender Logging-Appender + Datenbank</li>
        <li>Eigenbau</li>
        <li>Splunk</li>
        <li><b>E</b>lastic Search - <b>K</b>ibana - <b>L</b>ogstack</li>
        <li>...</li>
    </ul>
</section>
<section>
    <section>
        <h1>ELK Stack</h1>
        <p>&nbsp;</p>
        <img width="800" height="600" data-src="ELK Overview" alt="ELK Stack">
    </section>
    <section>
        <h1>Elastic Search</h1>
        <p>&nbsp;</p>
        <p>...</p>
    </section>
    <section>
        <h1>Kibana</h1>
        <p>&nbsp;</p>
        <p>...</p>
    </section>
    <section>
        <h1>Logstash</h1>
        <p>&nbsp;</p>
        <p>...</p>
    </section>
</section>

<!-- ------ Noch Fragen? ------- -->
<section>
    <h1>Und nun ihr!</h1>
    <p>&nbsp;</p>
    <h4>Bert Radke</h4>
    <p>(Google Plus) taseroth / bert.radke@t-systems.com</p>
    <p>&nbsp;</p>
    <h4>Marco Grunert</h4>
    <p>(Twitter) @magomi / marco.grunert@t-systems.com</p>
</section>
<section>
    <h1>Vielen Dank f&uuml;r eure Aufmerksamkeit!</h1>
    <h1>&nbsp;</h1>
    <h2 class="fragment">Jetzt aber wirklich.</h2>
</section>

<!-- ------ Ende ------- -->
        <script src="reveal.js/lib/js/head.min.js"></script>
        <script src="reveal.js/js/reveal.js"></script>
        <script>
            Reveal.initialize({
                dependencies: [
                    { src: 'reveal.js/plugin/notes/notes.js', async: true },
                    { src: 'reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                    { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
                ]
            });
        </script>
        <script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
    </body>
</html>
